<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Telegram Widget</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #1a1a1a;
      color: white;
    }
    .container {
      background: #333;
      padding: 30px;
      border-radius: 10px;
      border: 2px solid #FFD700;
    }
    h1 {
      color: #FFD700;
      text-align: center;
    }
    .widget-container {
      text-align: center;
      margin: 30px 0;
      padding: 20px;
      background: #222;
      border-radius: 8px;
    }
    .debug-info {
      background: #444;
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
      font-family: monospace;
      font-size: 12px;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      font-weight: bold;
    }
    .status.success { background: #4CAF50; color: white; }
    .status.error { background: #f44336; color: white; }
    .status.warning { background: #ff9800; color: white; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîê Telegram Login Widget Test</h1>
    
    <div class="debug-info">
      <strong>Debug Info:</strong><br>
      - Bot: darlinxloginbot<br>
      - Domain: localhost<br>
      - Script: https://telegram.org/js/telegram-widget.js?22
    </div>
    
    <div class="widget-container">
      <h3>Telegram Login Widget</h3>
      <div id="tg-widget"></div>
      <p>If you don't see the widget above, check the console for errors.</p>
    </div>
    
    <div id="status" class="status warning">
      Initializing...
    </div>
    
    <div class="debug-info" id="console-output">
      <strong>Console Output:</strong><br>
      <div id="log"></div>
    </div>
  </div>

  <script>
    // Debug logging
    function log(message) {
      const logDiv = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
      console.log(message);
    }

    function updateStatus(message, type = 'warning') {
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = message;
      statusDiv.className = `status ${type}`;
    }

    // Test Telegram Auth
    function onTelegramAuth(user) {
      log('‚úÖ Telegram auth successful!');
      log('User data: ' + JSON.stringify(user, null, 2));
      updateStatus('Login successful!', 'success');
    }

    // Initialize widget
    function initWidget() {
      log('üöÄ Initializing Telegram widget...');
      updateStatus('Loading widget...', 'warning');
      
      const widgetContainer = document.getElementById('tg-widget');
      if (!widgetContainer) {
        log('‚ùå Widget container not found!');
        updateStatus('Error: Widget container not found', 'error');
        return;
      }
      
      log('‚úÖ Widget container found');
      
      // Create script element
      const script = document.createElement('script');
      script.async = true;
      script.src = 'https://telegram.org/js/telegram-widget.js?22';
      script.setAttribute('data-telegram-login', 'darlinxloginbot');
      script.setAttribute('data-size', 'large');
      script.setAttribute('data-onauth', 'onTelegramAuth(user)');
      script.setAttribute('data-request-access', 'write');
      
      // Error handling
      script.onerror = function() {
        log('‚ùå Failed to load Telegram widget script');
        updateStatus('Failed to load widget script', 'error');
        widgetContainer.innerHTML = '<p style="color: #f44336;">Failed to load Telegram widget</p>';
      };
      
      script.onload = function() {
        log('‚úÖ Telegram widget script loaded successfully');
        updateStatus('Widget loaded successfully', 'success');
      };
      
      widgetContainer.appendChild(script);
      log('üìù Script element added to container');
    }

    // Alternative widget for testing
    function createTestWidget() {
      log('üîÑ Creating test widget...');
      const widgetContainer = document.getElementById('tg-widget');
      
      widgetContainer.innerHTML = `
        <div style="
          background: #0088cc;
          color: white;
          padding: 15px 25px;
          border-radius: 8px;
          cursor: pointer;
          font-size: 16px;
          font-weight: bold;
          display: inline-block;
          margin: 10px;
        " onclick="testAuth()">
          üîê Login with Telegram (Test)
        </div>
      `;
      
      updateStatus('Test widget created', 'warning');
    }

    function testAuth() {
      log('üß™ Test auth function called');
      const testUser = {
        id: 123456789,
        first_name: 'Test',
        last_name: 'User',
        username: 'testuser',
        photo_url: 'https://t.me/i/userpic/320/testuser.jpg',
        auth_date: Math.floor(Date.now() / 1000),
        hash: 'test_hash'
      };
      onTelegramAuth(testUser);
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
      log('üìÑ DOM loaded');
      
      // Try to initialize the real widget
      setTimeout(() => {
        initWidget();
        
        // Check if widget loaded after 5 seconds
        setTimeout(() => {
          const widgetContainer = document.getElementById('tg-widget');
          if (widgetContainer && widgetContainer.children.length === 0) {
            log('‚ö†Ô∏è Real widget not loaded, creating test widget');
            createTestWidget();
          }
        }, 5000);
      }, 1000);
    });
  </script>
</body>
</html> 
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quotes - No CSP Test</title>
  <style>
    body {
      font-family: 'VT323', monospace;
      background: #1a1a1a;
      color: white;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    h1 {
      color: #FFD700;
      text-align: center;
      font-size: 2.5rem;
    }
    .telegram-login-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.9);
      border: 2px solid #FFD700;
      border-radius: 8px;
      padding: 15px;
      min-width: 200px;
    }
    .telegram-login-container h3 {
      color: #FFD700;
      margin: 0 0 10px 0;
      font-size: 1.1rem;
    }
    .telegram-login-container p {
      color: rgba(255, 255, 255, 0.8);
      margin: 0 0 10px 0;
      font-size: 0.9rem;
    }
    .quote-item {
      margin-bottom: 2rem;
      border-left: 3px solid #FFD700;
      padding-left: 1.5rem;
      background: rgba(0, 0, 0, 0.5);
      padding: 1rem;
      border-radius: 0 8px 8px 0;
    }
    .quote-text {
      font-size: 1.3rem;
      color: rgba(255, 255, 255, 0.9);
      line-height: 1.4;
      margin-bottom: 0.5rem;
    }
    .quote-author {
      font-size: 1rem;
      color: #FFD700;
      text-align: right;
    }
    .quote-meta {
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.6);
      margin-top: 0.5rem;
    }
    .demo-notice {
      text-align: center;
      color: rgba(255, 255, 255, 0.6);
      margin-top: 2rem;
      padding: 1rem;
      background: rgba(255, 215, 0, 0.1);
      border-radius: 8px;
    }
    .telegram-button {
      background: #0088cc;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-family: VT323, monospace;
      font-size: 1rem;
      text-align: center;
      border: none;
      display: inline-block;
      text-decoration: none;
      transition: background-color 0.3s ease;
    }
    .telegram-button:hover {
      background: #0077b3;
    }
    .status {
      padding: 8px;
      margin: 5px 0;
      border-radius: 4px;
      font-size: 0.8rem;
    }
    .status.success { background: #4CAF50; color: white; }
    .status.error { background: #f44336; color: white; }
    .status.warning { background: #ff9800; color: white; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Community Quotes</h1>
    
    <!-- Status Display -->
    <div id="status" class="status warning">Initializing...</div>
    
    <!-- Telegram Login Widget -->
    <div id="telegramLoginContainer" class="telegram-login-container">
      <h3>üîê Login</h3>
      <p>Login with Telegram to add quotes</p>
      <div id="tg-widget"></div>
    </div>

    <!-- Demo Quotes -->
    <div id="quotesList">
      <div class="quote-item">
        <div class="quote-text">"‚Äî If it entertains you now but will bore you someday, it's a distraction. Keep looking."</div>
        <div class="quote-author">‚Äî Inkspirify</div>
        <div class="quote-meta">by @demo ¬∑ Demo quote</div>
      </div>
      <div class="quote-item">
        <div class="quote-text">"‚Äî Your 20s are the perfect time to do a few things that are unusual, weird, bold, risky, unexplainable, crazy, unprofitable, and look nothing like "success." For the rest of your life these experiences will serve as your muse."</div>
        <div class="quote-author">‚Äî Inkspirify</div>
        <div class="quote-meta">by @demo ¬∑ Demo quote</div>
      </div>
      <div class="quote-item">
        <div class="quote-text">"‚Äî I don't have talent, so I just get up earlier."</div>
        <div class="quote-author">‚Äî Inkspirify</div>
        <div class="quote-meta">by @demo ¬∑ Demo quote</div>
      </div>
    </div>
    
    <div class="demo-notice">
      üîß Demo mode - Login with Telegram to add real quotes!
    </div>
  </div>

  <script>
    // Status update function
    function updateStatus(message, type = 'warning') {
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = message;
      statusDiv.className = `status ${type}`;
      console.log(`[${type.toUpperCase()}] ${message}`);
    }

    console.log('üîç Starting quotes page without CSP restrictions...');
    updateStatus('Page loaded, initializing...', 'warning');
    
    // Method 1: Direct script injection
    function initTelegramWidget() {
      updateStatus('Loading Telegram widget...', 'warning');
      
      const widgetContainer = document.getElementById('tg-widget');
      if (!widgetContainer) {
        updateStatus('Error: Widget container not found', 'error');
        return;
      }
      
      // Clear container
      widgetContainer.innerHTML = '';
      
      try {
        // Create script element
        const script = document.createElement('script');
        script.async = true;
        script.src = 'https://telegram.org/js/telegram-widget.js?22';
        script.setAttribute('data-telegram-login', 'darlinxloginbot');
        script.setAttribute('data-size', 'large');
        script.setAttribute('data-onauth', 'onTelegramAuth(user)');
        script.setAttribute('data-request-access', 'write');
        
        script.onload = function() {
          updateStatus('Telegram widget loaded successfully!', 'success');
        };
        
        script.onerror = function() {
          updateStatus('Failed to load Telegram widget, using alternative', 'error');
          initAlternativeWidget();
        };
        
        widgetContainer.appendChild(script);
        updateStatus('Script element added, waiting for load...', 'warning');
        
        // Timeout fallback
        setTimeout(() => {
          if (widgetContainer.children.length === 0) {
            updateStatus('Widget timeout, using alternative', 'warning');
            initAlternativeWidget();
          }
        }, 5000);
        
      } catch (error) {
        updateStatus('Error creating widget: ' + error.message, 'error');
        initAlternativeWidget();
      }
    }

    // Method 2: Alternative with direct link
    function initAlternativeWidget() {
      updateStatus('Creating alternative login method...', 'warning');
      
      const widgetContainer = document.getElementById('tg-widget');
      if (!widgetContainer) {
        updateStatus('Error: Widget container not found', 'error');
        return;
      }
      
      widgetContainer.innerHTML = `
        <a href="https://oauth.telegram.org/auth?bot_id=8089091309&request_access=write&origin=${encodeURIComponent(window.location.origin)}" 
           class="telegram-button" 
           target="_blank"
           onclick="handleTelegramLogin(event)">
          üîê Login with Telegram
        </a>
        <p style="font-size: 0.8rem; margin-top: 8px; color: rgba(255,255,255,0.6);">
          Opens in new tab
        </p>
      `;
      
      updateStatus('Alternative login method ready', 'success');
    }

    // Method 3: Test button
    function initTestWidget() {
      updateStatus('Creating test login button...', 'warning');
      
      const widgetContainer = document.getElementById('tg-widget');
      if (!widgetContainer) {
        updateStatus('Error: Widget container not found', 'error');
        return;
      }
      
      widgetContainer.innerHTML = `
        <button class="telegram-button" onclick="testTelegramAuth()">
          üîê Login with Telegram (Test)
        </button>
        <p style="font-size: 0.8rem; margin-top: 8px; color: rgba(255,255,255,0.6);">
          Test mode - no real authentication
        </p>
      `;
      
      updateStatus('Test login button ready', 'success');
    }

    // Handle Telegram login
    function handleTelegramLogin(event) {
      updateStatus('Opening Telegram login...', 'warning');
      console.log('üîó Opening Telegram login in new tab');
    }

    // Test function
    function testTelegramAuth() {
      updateStatus('Test authentication triggered', 'success');
      alert('üß™ Test Mode\n\nThis is a test button. In production, this would:\n\n1. Open Telegram login page\n2. Authenticate user with Telegram\n3. Return user data to the application\n4. Show user profile and allow adding quotes\n\nFor real authentication, you need:\n- A configured Telegram bot\n- Proper domain setup\n- Server-side API endpoints');
    }

    // Telegram Auth Handler
    function onTelegramAuth(user) {
      updateStatus('Telegram authentication successful!', 'success');
      console.log('üéâ Telegram auth successful!', user);
      alert('‚úÖ Login Successful!\n\nUser: ' + (user.first_name || 'Unknown') + '\nUsername: @' + (user.username || 'none') + '\n\nIn a real application, this would:\n- Save user session\n- Show user profile\n- Enable quote management');
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
      updateStatus('DOM loaded, starting initialization...', 'warning');
      
      // Try to load the real widget
      setTimeout(() => {
        initTelegramWidget();
      }, 1000);
    });

    // Listen for messages from Telegram
    window.addEventListener('message', function(event) {
      if (event.origin === 'https://oauth.telegram.org') {
        console.log('üì® Received message from Telegram:', event.data);
        updateStatus('Received message from Telegram', 'success');
        if (event.data && event.data.user) {
          onTelegramAuth(event.data.user);
        }
      }
    });

    // Global error handler
    window.addEventListener('error', function(event) {
      console.error('Global error:', event.error);
      updateStatus('JavaScript error occurred', 'error');
    });
  </script>
</body>
</html> 